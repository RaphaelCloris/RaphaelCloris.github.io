<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥½æƒ³è¢«ç½µ - LINE é¢¨æ ¼ + è²¼åœ–ç‰ˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', sans-serif;
            background: #f0f0f0;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
            overflow: hidden;
        }
        /* LINE é ‚éƒ¨æ¬„ */
        .header {
            background: #00b900;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.4em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            position: relative;
        }
        .backBtn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.8em;
            cursor: pointer;
        }
        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            background: linear-gradient(135deg, #ff00ff, #ff3366);
            display: inline-block;
            vertical-align: middle;
            margin-right: 12px;
        }
        /* èŠå¤©å€ */
        #chatContainer {
            flex: 1;
            overflow-y: auto;
            padding: 20px 15px;
            background: #d8e6d1;
        }
        .message {
            margin: 10px 0;
            display: flex;
            align-items: flex-end;
        }
        .message.scolder { justify-content: flex-start; }
        .message.user { justify-content: flex-end; }
        .bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 1.5em;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
        }
        .scolder .bubble {
            background: #ffffff;
            color: #333;
            border-bottom-left-radius: 5px;
        }
        .user .bubble {
            background: #a8e063;
            color: #333;
            border-bottom-right-radius: 5px;
        }
        .sticker {
            width: 180px;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .meta {
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
            display: flex;
            align-items: center;
        }
        .message.scolder .meta { margin-left: 10px; }
        .message.user .meta {
            margin-right: 10px;
            justify-content: flex-end;
        }
        .read {
            margin-left: 5px;
            color: #666;
            font-size: 0.9em;
        }
        /* åº•éƒ¨è¼¸å…¥å€ */
        #bottomBar {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-top: 1px solid #ddd;
            position: relative;
        }
        #quickReplies {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        .replyBtn {
            padding: 10px 18px;
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 1.2em;
            cursor: pointer;
        }
        .replyBtn:hover {
            background: #e0e0e0;
        }
        #stickerBtn {
            width: 50px;
            height: 50px;
            background: url('https://stickershop.line-scdn.net/stickershop/v1/product/1001/thumbnail@2x.png') center/cover;
            border-radius: 10px;
            cursor: pointer;
            margin-left: 10px;
        }
        /* è²¼åœ–é¸æ“‡é¢æ¿ */
        #stickerPanel {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            max-height: 40vh;
            overflow-y: auto;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }
        .stickerOption {
            width: 100px;
            height: 100px;
            object-fit: contain;
            cursor: pointer;
            border-radius: 10px;
            transition: transform 0.2s;
        }
        .stickerOption:hover {
            transform: scale(1.2);
        }
        /* é–‹å§‹ç•«é¢ */
        #startScreen {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #00b900, #00d900);
            color: white;
        }
        #startScreen h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        #scoldForm {
            background: rgba(255,255,255,0.2);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
        }
        select {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border-radius: 12px;
            border: none;
            background: rgba(255,255,255,0.3);
            color: white;
            font-size: 1.3em;
        }
        button#startBtn {
            width: 100%;
            padding: 20px;
            font-size: 1.8em;
            background: white;
            color: #00b900;
            border: none;
            border-radius: 15px;
            margin-top: 20px;
            cursor: pointer;
            font-weight: bold;
        }
        audio { display: none; }
    </style>
</head>
<body>
    <!-- é–‹å§‹ç•«é¢ -->
    <div id="startScreen">
        <h1>å¥½æƒ³è¢«ç½µ ğŸ˜ˆ</h1>
        <p style="font-size:1.5em;margin-bottom:30px;">LINE é¢¨æ ¼ + è²¼åœ–ç‰ˆ Â· ç™¼è²¼åœ–ä¹Ÿæœƒè¢«ç½µ</p>
        <form id="scoldForm">
            <select id="job" required>
                <option value="">ä½ çš„è·æ¥­æ˜¯ï¼Ÿ</option>
                <option value="å­¸ç”Ÿ">å­¸ç”Ÿ</option>
                <option value="ä¸Šç­æ—">ä¸Šç­æ—</option>
                <option value="è‡ªç”±æ¥­è€…">è‡ªç”±æ¥­è€…</option>
                <option value="è€é—†">è€é—†</option>
                <option value="ç„¡æ¥­éŠæ°‘">ç„¡æ¥­éŠæ°‘</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
            <select id="scolder" required>
                <option value="">æƒ³è¢«èª°ç½µï¼Ÿ</option>
                <option value="åª½åª½">åª½åª½</option>
                <option value="è€é—†">è€é—†</option>
                <option value="å‰ä»»">å‰ä»»</option>
                <option value="è€å¸«">è€å¸«</option>
                <option value="ç¶²å‹">ç¶²å‹</option>
            </select>
            <button type="submit" id="startBtn">é–‹å§‹èŠå¤©ï¼ˆè¢«ç½µï¼‰</button>
        </form>
    </div>

    <!-- LINE èŠå¤©ä»‹é¢ -->
    <div id="chatInterface" style="display:none;flex-direction:column;height:100vh;">
        <div class="header">
            <button class="backBtn" aria-label="é‡æ–°é–‹å§‹">â†</button>
            <div class="avatar"></div>
            <span id="scolderName">åª½åª½</span>
        </div>
        <div id="chatContainer"></div>
        <div id="bottomBar">
            <div id="quickReplies"></div>
            <div id="stickerBtn" title="è²¼åœ–" aria-label="é–‹å•Ÿè²¼åœ–"></div>
        </div>
    </div>

    <!-- è²¼åœ–é¢æ¿ -->
    <div id="stickerPanel">
        <img class="stickerOption" src="https://stickershop.line-scdn.net/stickershop/v1/sticker/1003/android/sticker.png;compress=true" alt="ç†Šå¤§ç”Ÿæ°£">
        <img class="stickerOption" src="https://stickershop.line-scdn.net/stickershop/v1/sticker/1005/android/sticker.png;compress=true" alt="å…”å…”ç¿»ç™½çœ¼">
        <img class="stickerOption" src="https://stickershop.line-scdn.net/stickershop/v1/sticker/1015/android/sticker.png;compress=true" alt="é¥…é ­äººå“­å“­">
        <img class="stickerOption" src="https://stickershop.line-scdn.net/stickershop/v1/sticker/1008/android/sticker.png;compress=true" alt="ç†Šå¤§ç¬‘æ­»">
        <img class="stickerOption" src="https://stickershop.line-scdn.net/stickershop/v1/sticker/1021/android/sticker.png;compress=true" alt="å…”å…”ç”Ÿæ°£">
        <img class="stickerOption" src="https://stickershop.line-scdn.net/stickershop/v1/sticker/1018/android/sticker.png;compress=true" alt="é¥…é ­äººæŒ‘é‡">
    </div>

    <!-- éŸ³æ•ˆ -->
    <audio id="sendSound" src="https://cdn.freesound.org/previews/612/612610_5674468-lq.mp3" preload="auto"></audio>
    <audio id="receiveSound" src="https://cdn.freesound.org/previews/522/522262_10387714-lq.mp3" preload="auto"></audio>

    <script>
        // æ‰€æœ‰ç½µå¥è³‡æ–™ï¼ˆèˆ‡åŸç‰ˆå®Œå…¨ç›¸åŒï¼‰
        const firstScolds = { /* ... é€™è£¡çœç•¥ï¼Œå…§å®¹èˆ‡ä½ åŸæœ¬å®Œå…¨ä¸€æ¨£ ... */ };
        const followUpScolds = { /* ... é€™è£¡çœç•¥ï¼Œå…§å®¹èˆ‡ä½ åŸæœ¬å®Œå…¨ä¸€æ¨£ ... */ };
        const quickRepliesPool = [
            "ä¸æœæ°£å•Šï¼Ÿæœ‰ç¨®å†èªª",
            "å¥½å•¦æˆ‘éŒ¯äº†åˆ¥ç½µäº†",
            "ä½ èƒ½å†ç‹ ä¸€é»å—ï¼Ÿ",
            "å“ˆå“ˆæˆ‘å°±æ˜¯å»¢ç‰©å•¦",
            "å—šå—šæˆ‘å“­äº†",
            "ä¾†å•Šäº’ç›¸å‚·å®³å•Š",
            "å°ä¸èµ·æˆ‘çœŸçš„éŒ¯äº†",
            "æˆ‘è·‘äº†æ°æ°"
        ];

        // å…ƒç´ 
        const chatContainer = document.getElementById('chatContainer');
        const quickReplies = document.getElementById('quickReplies');
        const scolderNameSpan = document.getElementById('scolderName');
        const stickerPanel = document.getElementById('stickerPanel');
        const stickerBtn = document.getElementById('stickerBtn');
        const backBtn = document.querySelector('.backBtn');
        const sendSound = document.getElementById('sendSound');
        const receiveSound = document.getElementById('receiveSound');
        const startScreen = document.getElementById('startScreen');
        const chatInterface = document.getElementById('chatInterface');

        let currentJob = "";
        let currentScolder = "";
        let audioUnlocked = false;

        // è§£é–éŸ³æ•ˆï¼ˆé»æ“Šé–‹å§‹æŒ‰éˆ•æ™‚è§£é–ï¼‰
        function unlockAudio() {
            if (audioUnlocked) return;
            sendSound.play().catch(() => {});
            receiveSound.play().catch(() => {});
            sendSound.pause(); sendSound.currentTime = 0;
            receiveSound.pause(); receiveSound.currentTime = 0;
            audioUnlocked = true;
        }

        function getTime() {
            const now = new Date();
            return now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, sender, isSticker = false) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            if (isSticker) {
                const img = document.createElement('img');
                img.src = content;
                img.className = 'sticker';
                img.alt = 'è²¼åœ–';
                msgDiv.appendChild(img);
            } else {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.textContent = content;
                msgDiv.appendChild(bubble);
            }
            const meta = document.createElement('div');
            meta.className = 'meta';
            meta.textContent = getTime();
            if (sender === 'user') {
                const read = document.createElement('span');
                read.className = 'read';
                read.textContent = ' å·²è®€';
                meta.appendChild(read);
            }
            msgDiv.appendChild(meta);
            chatContainer.appendChild(msgDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function typeMessage(text, sender, callback) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${sender}`;
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.textContent = '';
            const meta = document.createElement('div');
            meta.className = 'meta';
            meta.textContent = getTime();
            msgDiv.appendChild(bubble);
            msgDiv.appendChild(meta);
            chatContainer.appendChild(msgDiv);

            if (audioUnlocked) receiveSound.play().catch(() => {});

            let i = 0;
            const interval = setInterval(() => {
                if (i < text.length) {
                    bubble.textContent += text.charAt(i);
                    i++;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                } else {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 60);
        }

        function showQuickReplies() {
            quickReplies.innerHTML = '';
            const shuffled = [...quickRepliesPool].sort(() => 0.5 - Math.random());
            shuffled.slice(0, 3).forEach(text => {
                const btn = document.createElement('button');
                btn.className = 'replyBtn';
                btn.textContent = text;
                btn.setAttribute('aria-label', `å¿«é€Ÿå›è¦†ï¼š${text}`);
                btn.onclick = () => userReply(text);
                quickReplies.appendChild(btn);
            });
        }

        function userReply(text) {
            addMessage(text, 'user');
            if (audioUnlocked) sendSound.play().catch(() => {});
            quickReplies.innerHTML = '';
            stickerPanel.style.display = 'none';

            setTimeout(() => {
                let attitude = "å˜´ç¡¬";
                if (text.includes("ä¸æœæ°£") || text.includes("æœ‰ç¨®")) attitude = "ä¸æœæ°£";
                else if (text.includes("éŒ¯äº†") || text.includes("å°ä¸èµ·")) attitude = "æ±‚é¥’";
                else if (text.includes("ç‹ ") || text.includes("äº’ç›¸") || text.includes("ä¾†å•Š")) attitude = "å˜´ç¡¬";
                else if (text.includes("å»¢ç‰©")) attitude = "è‡ªå˜²";
                else if (text.includes("å“­")) attitude = "å“­";
                else if (text.includes("æŒ‘é‡")) attitude = "æŒ‘é‡";
                else if (text.includes("èªéŒ¯")) attitude = "èªéŒ¯";
                else if (text.includes("è·‘") || text.includes("æ°æ°")) attitude = "é€ƒè·‘";

                let reply = followUpScolds[attitude];
                reply = reply.replace(/{job}/g, currentJob).replace(/{scolder}/g, currentScolder);
                typeMessage(reply, 'scolder', showQuickReplies);
            }, 1200 + Math.random() * 1000);
        }

        // è²¼åœ–åŠŸèƒ½
        stickerBtn.onclick = (e) => {
            e.stopPropagation();
            stickerPanel.style.display = stickerPanel.style.display === 'flex' ? 'none' : 'flex';
        };

        document.querySelectorAll('.stickerOption').forEach(img => {
            img.onclick = (e) => {
                e.stopPropagation();
                addMessage(img.src, 'user', true);
                if (audioUnlocked) sendSound.play().catch(() => {});
                stickerPanel.style.display = 'none';
                quickReplies.innerHTML = '';

                setTimeout(() => {
                    let reply = followUpScolds["è²¼åœ–"];
                    reply = reply.replace(/{job}/g, currentJob).replace(/{scolder}/g, currentScolder);
                    typeMessage(reply, 'scolder', showQuickReplies);
                }, 1500);
            };
        });

        // é»æ“Šå¤–éƒ¨é—œé–‰è²¼åœ–é¢æ¿ï¼ˆä½†ä¸åŒ…å« bottomBarï¼‰
        document.addEventListener('click', () => {
            if (stickerPanel.style.display === 'flex') {
                stickerPanel.style.display = 'none';
            }
        });
        bottomBar.addEventListener('click', (e) => e.stopPropagation());

        // é‡æ–°é–‹å§‹
        backBtn.onclick = () => {
            startScreen.style.display = 'flex';
            chatInterface.style.display = 'none';
            chatContainer.innerHTML = '';
            quickReplies.innerHTML = '';
            stickerPanel.style.display = 'none';
        };

        // é–‹å§‹éŠæˆ²
        document.getElementById('scoldForm').addEventListener('submit', e => {
            e.preventDefault();
            unlockAudio(); // è§£é–éŸ³æ•ˆ
            currentJob = document.getElementById('job').value;
            currentScolder = document.getElementById('scolder').value;
            if (!currentJob || !currentScolder) return;

            scolderNameSpan.textContent = currentScolder;
            const key = `${currentJob}_${currentScolder}`;
            const firstMsg = firstScolds[key] || "å»¢ç‰©ï¼ä½ èª°å•Šï¼Ÿæ»¾ï¼";

            startScreen.style.display = 'none';
            chatInterface.style.display = 'flex';

            setTimeout(() => {
                typeMessage(firstMsg, 'scolder', showQuickReplies);
            }, 800);
        });

        // è«‹å°‡åŸæœ¬çš„ firstScolds å’Œ followUpScolds ç‰©ä»¶å®Œæ•´è²¼å›é€™è£¡ï¼ˆæˆ‘ç‚ºäº†ç¯€çœç¯‡å¹…çœç•¥äº†ï¼Œä½†ä½ è¦è¨˜å¾—ä¿ç•™åŸæœ¬çš„æ‰€æœ‰ç½µå¥ï¼‰
    </script>
</body>
</html>
